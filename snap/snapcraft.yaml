name: cubetimer # you probably want to 'snapcraft register <name>'
base: core22 # the base snap is the execution environment for this snap
version: '0.1' # just for humans, typically '1.2+git' or '1.3.2'
summary: Simple rubik cube timer, like stackmat but for Linux.
description: |
  This is my-snap's description. You have a paragraph or two to tell the
  most important story about your snap. Keep it under 100 words though,
  we live in tweetspace and your description wants to look good in the snap
  store.

grade: stable # must be 'stable' to release into candidate/stable channels
confinement: devmode # use 'strict' once you have the right plugs and slots

environment:
  PYTHONPATH: ${SNAP}/lib/python3.10/site-packages:${SNAP}/usr/lib/python3/dist-packages

apps:
  cubetimer:
    extensions: [gnome]
    command: usr/bin/cubetimer
    desktop: usr/share/applications/xyz.aguno.CubeTimer.desktop
    common-id: xyz.aguno.CubeTimer.desktop
    environment:
      PYTHONPATH: ${SNAP}/lib/ython3.10/site-packages:${SNAP}/usr/lib/python3/dist-packages

layout:
  /usr/share/cubetimer:
    bind: $SNAP/usr/share/cubetimer

parts:
  cubetimer:
    source: https://github.com/herpiko/cubetimer
    source-tag: 'master'
    source-type: git
    plugin: meson
    meson-parameters:
      - --prefix=/usr
      - --buildtype=release
    parse-info: [usr/share/metainfo/xyz.aguno.CubeTimer.appdata.xml]
    build-packages:
      - meson
      - ninja-build
      - python3
    stage-packages:
      - python3
    override-build: |
      craftctl default
      # WORKAROUND: Use python from search path, the path detected by meson doesn't exist when running the Snap
      sed -e '1c#!/usr/bin/env python3' -i "${CRAFT_PART_INSTALL}/usr/bin/cubetimer"
      #BASEDIR=$(echo "${SNAP}" | cut -d '/' -f 4)
      #sed -i 's/\/usr\/share/\/snap\/snapcraft\/'"${BASEDIR}"'\/usr\/share/g' "${CRAFT_PART_INSTALL}/usr/bin/cubetimer"
      #echo "#!/bin/sh" > "${CRAFT_PART_INSTALL}/usr/bin/cubetimer"
      #echo "cd ${SNAP}" >> "${CRAFT_PART_INSTALL}/usr/bin/cubetimer"
      #echo "ls" >> "${CRAFT_PART_INSTALL}/usr/bin/cubetimer"
      #echo "pwd" >> "${CRAFT_PART_INSTALL}/usr/bin/cubetimer"
      #echo "ls usr/share/" >> "${CRAFT_PART_INSTALL}/usr/bin/cubetimer"
      #echo "cat usr/share/cubetimer.gresource" >> "${CRAFT_PART_INSTALL}/usr/bin/cubetimer"
